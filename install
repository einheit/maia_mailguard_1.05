#!/usr/bin/env bash

DBG=0
DEF=0

# get os
if [ -f /etc/fedora-release ]; then
  export LXTYPE=FEDORA
elif [ -f /etc/rocky-release ]; then
  export LXTYPE=ROCKY
elif [ -f /etc/almalinux-release ]; then
  export LXTYPE=ALMA
elif [ -f /etc/centos-release ]; then
  export LXTYPE=CENTOS
elif [ -f /etc/oracle-release ]; then
  export LXTYPE=RHEL
elif [ -f /etc/redhat-release ]; then
  export LXTYPE=RHEL
elif [ -f /etc/SuSE-release ]; then
  export LXTYPE=SUSE
elif [ -f /etc/SUSE-brand ]; then
  export LXTYPE=SUSE
elif [ -f /etc/debian_version ]; then
  export LXTYPE=DEBIAN
elif [ -f /etc/gentoo-release ]; then
  export LXTYPE=GENTOO
fi

cat /etc/rocky-release | awk '{ print $4 }' | awk -F\. '{ print $1 }'

if [ $LXTYPE == "ROCKY" ]; then
  ID="rocky"
  VER=`cat /etc/rocky-release | awk '{ print $4 }' | awk -F\. '{ print $1 }'`
  if [ -f installers/${ID}-${VER}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${ID}-${VER}.sh | tee installer.log 2>&1"
    echo
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "RHEL or derivative detected:"
    echo "VER = $VER"
    echo "$ID version $VER"
    echo "### DEBUG ###"
    echo
  fi
fi
 
if [ $LXTYPE == "ALMA" ]; then
  ID="alma"
  VER=`grep '^VERSION=' /etc/os-release|awk '{ print $1 }'|awk -F\" '{ print $2 }'|awk -F\. '{ print $1 }'`
  if [ -f installers/${ID}-${VER}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${ID}-${VER}.sh | tee installer.log 2>&1"
    echo
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "RHEL or derivative detected:"
    echo "VER = $VER"
    echo "$ID version $VER"
    echo "### DEBUG ###"
    echo
  fi
fi
 
if [ $LXTYPE == "CENTOS" ]; then
  RID=`grep ^ID= /etc/os-release | awk -F\= '{ print $2 }'`
  ID=`echo $RID | sed 's/"//g'`
  VER=`grep ^VERSION_ID= /etc/os-release | awk -F\= '{ print $2 }'| tr -d \"`

  if [ -f installers/${ID}-${VER}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${ID}-${VER}.sh | tee installer.log 2>&1"
    echo
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "RHEL or derivative detected:"
    echo "VER = $VER"
    echo "$ID version $VER"
    echo "### DEBUG ###"
    echo
  fi
fi
 
if [ $LXTYPE == "FEDORA" ]; then
  RID=`grep ^RID= /etc/os-release | awk -F\= '{ print $2 }'`
  ID=`echo $ID | sed 's/"//g'`
  VER=`grep ^VERSION_ID= /etc/os-release | awk -F\= '{ print $2 }'| tr -d \"`

  if [ -f installers/${ID}-${VER}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${ID}-${VER}.sh | tee installer.log 2>&1"
    echo
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "RHEL or derivative detected:"
    echo "RVER = $RVER"
    echo "$ID version $VER"
    echo "### DEBUG ###"
    echo
  fi
fi
 
if [ $LXTYPE == "RHEL" ]; then
# RHEL variant -
  if [ -f /etc/os-release ]; then
    RHID=`grep '^ID=' /etc/os-release|awk -F= '{ print $2 }' | tr -d \"`
    RREL=`grep '^VERSION_ID=' /etc/os-release | awk -F= '{ print $2 }' | tr -d \" | cut -c1-1`
  else
    # looks like an older release
    RAWVER=`cat /etc/redhat-release`
    RREL=`echo $RAWVER|tr -d [A-Za-z\(\)]|tr -d " "|awk -F\. ' { print $1 }'`
    RHID=`echo $RAWVER|tr -d [0-9\(\)]|awk '{print $1 }'| tr [A-Z] [a-z]`
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "redhat-release: $RAWVER"
    echo "VERSION_ID from os-release: $RHID"
    echo "ID from os-release: $RREL"
    echo "installer: ${RHID}-${RREL}.sh"
    echo "### DEBUG ###"
    echo
  fi
  if [ $RHID == 'ol' ];
  then
      RHID=oracle
      RREL=`echo $RREL | awk -F\. '{ print $1 }'`
  fi
  if [ -f installers/${RHID}-${RREL}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${RHID}-${RREL}.sh | tee installer.log 2>&1"
    echo
  fi
fi

if [ $LXTYPE == "DEBIAN" ]; then
  ID=`grep ^ID= /etc/os-release | awk -F\= '{ print $2 }'`
  VER=`grep ^VERSION_ID= /etc/os-release | awk -F\= '{ print $2 }'| tr -d \"`

  if [ -f installers/${ID}-${VER}.sh ]; then
    DEF=1
    echo "copy & paste the following command to begin the install:"
    echo
    echo " bash installers/${ID}-${VER}.sh | tee installer.log 2>&1"
    echo
  fi
  if [ $DBG -ne 0 ]; then
    echo
    echo "### DEBUG ###"
    echo "Debian or derivative detected:"
    echo "RVER = $RVER"
    echo "$ID version $VER"
    echo "### DEBUG ###"
    echo
  fi
fi

if [ $DEF == 0 ]; then
  echo "$LXTYPE type system detected, you can try the installer that seems"
  echo "most closely related to yours (scripts in the installers directory)"
  echo "or refer to manual-install.txt for generic install procedures"
fi


